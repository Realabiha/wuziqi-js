<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./images/favorite.ico">
    <title>Document</title>
</head>
<style>
    html, body{
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        padding: 0;
        background: wheat;
    }
    div{
        width: 1024px;
        height: 1016px;
        background-image: url('./images/bg.jpg');
        background-repeat: no-repeat;
        background-size: 100% 100%;
        padding: 50px 30px 65px 42px;
    }
    table{
        width: 100%;
        height: 100%;
        border-collapse: collapse;
        padding-left: 20px;
        border-spacing: 0;
        /* box-sizing: border-box; */
    }
    td{
        width: 55px;
        height: 55px;
        background: wheat;
        border: 1px solid #000;
        box-sizing: border-box;
    }
</style>
<body>
    <div>
        <table>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>       
            </tbody>
        </table>
    </div>
</body>
<script>

    // 声明常量

    // 比赛结果状态
    let result = false;
    // 下棋步数
    let total = 0;
    // 棋盘二维数组(横向为y,纵向为x,18*18)
    const arr = [];
    // 上个棋子颜色标记
    let flag = 'black';
    // 点击棋盘外弹窗内容
    const alerts = [
        '下雨了,回家收衣服啦!',
        '棋盘大小是18*18!',
        '不要迷恋哥!',
        '你是GG还是MM?',
        '先手会有优势!',
        '我的发量很健康!',
        '我是一个自带板砖的前端!',
        '扫码改需求!',
        '这是一张背景图!',
        '你好!'
    ];


    // 点击棋盘区域外回调
    document.onclick = _ => {
        const index = parseInt(Math.random()*10);
        alert(`${alerts[index]}`);
    }
    
    // 获取所有棋子并初始化
    const bts = document.querySelectorAll('td');
    for(let i = 0; i < 18; i ++){
        arr.push([]);
    }
    bts.forEach((v, i) => {
        // 设置棋盘点击状态(false|black|white)
        v.$color = false;
        // 棋盘点击回调
        v.onclick = handleClick;
        // 棋盘二维数组分组(有待改进。。。。)
        if(i <= 17){
            v.$x = 0;
            v.$y = i%18;
            arr[0].push(v)
        }
        if(i>=18&&i<=35){
            v.$x = 1;
            v.$y = i%18;
            arr[1].push(v)

        }
        if(i>=36&&i<=53){
            v.$x = 2;
            v.$y = i%18;
            arr[2].push(v)
        }
        if(i>=54&&i<=71){
            v.$x = 3;
            v.$y = i%18;
            arr[3].push(v)
        }
        if(i>=72&&i<=89){
            v.$x = 4;
            v.$y = i%18;
            arr[4].push(v)
        }
        if(i>=90&&i<=107){
            v.$x = 5;
            v.$y = i%18;
            arr[5].push(v)
        }
        if(i>=108&&i<=125){
            v.$x = 6;
            v.$y = i%18;
            arr[6].push(v)
        }
        if(i>=126&&i<=143){
            v.$x = 7;
            v.$y = i%18;
            arr[7].push(v)
        }
        if(i>=144&&i<=161){
            v.$x = 8;
            v.$y = i%18;
            arr[8].push(v)
        }
        if(i>=162&&i<=179){
            v.$x = 9;
            v.$y = i%18;
            arr[9].push(v)
        }
        if(i>=180&&i<=197){
            v.$x = 10;
            v.$y = i%18;
            arr[10].push(v)
        }
        if(i>=198&&i<=215){
            v.$x = 11;
            v.$y = i%18;
            arr[11].push(v)
        }
        if(i>=216&&i<=233){
            v.$x = 12;
            v.$y = i%18;
            arr[12].push(v)
        }
        if(i>=234&&i<=251){
            v.$x = 13;
            v.$y = i%18;
            arr[13].push(v)
        }
        if(i>=252&&i<=269){
            v.$x = 14;
            v.$y = i%18;
            arr[14].push(v)
        }
        if(i>=270&&i<=287){
            v.$x = 15;
            v.$y = i%18;
            arr[15].push(v)
        }
        if(i>=288&&i<=305){
            v.$x = 16;
            v.$y = i%18;
            arr[16].push(v)
        }
        if(i>=306&&i<=323){
            v.$x = 17;
            v.$y = i%18;
            arr[17].push(v)
        }
    })
    

    

    // 下棋点击事件
    function handleClick(e){
        // 阻止事件冒泡
        if(e.stopPropagation){
            e.stopPropagation && e.stopPropagation();
        }else{
            e.cancelBubble = true; // IE
        }
        
        // 阻止二次点击
        if(this.$color) return;

        // 标记当前棋子颜色
        this.$color = flag;

        // 判断棋子颜色
        if(flag == 'black'){
            drawBlack.call(this);
        }else{
            darwWhite.call(this);
        }

        total ++;

        // 下棋步数超过9做输赢判断 
        if(total >= 9){
            calc.call(this);
        }
    }


    // 黑棋
    function drawBlack(){
        this.style.background = '#000';
        this.style.borderRadius = '50%';
        flag = 'white';
    }
    // 白棋
    function darwWhite(){
        this.style.background = '#fff';
        this.style.borderRadius = '50%';
        flag = 'black';
    }
    // 判断输赢
    function calc(){
        const x = this.$x, y = this.$y, color = this.$color;
        
        // 四个方向依次判断
        row.call(this, x, y, []);
        column.call(this, x, y, []);
        leftDown.call(this, x, y, []);
        leftTop.call(this, x, y, []);

        if(result){
            setTimeout(_=>{
                alert(`比赛结束${this.$color == 'white' ? '白' : '黑'}棋胜利！`)
                // 重置比赛
                window.location.reload();
            }, 0)
        }

    }

    // 横纵方向比较好判断
    // 斜向注意棋盘边界判断(0-17)

    // 横向判断
    function row(x, y, target){
        if(y > 3 && y < 14){
            for(let i = y - 4; i <= y + 4; i ++){
                target.push(arr[x][i]);
            }
        }
        if(y <= 3){
            for(let i = 0; i <= y + 4; i ++){
                target.push(arr[x][i]);
            }
        }
        if(y >= 14){
            for(let i = 17; i >= y - 4; i --){
                target.push(arr[x][i]);
            }
        }
        count.call(this, target);
    }

    // 纵向判断
    function column(x, y, target){
        if(x > 3 && x < 14){
            for(let i = x - 4; i <= x + 4; i ++){
                target.push(arr[i][y]);
            }
        }
        if(x <= 3){
            for(let i = 0; i <= x + 4; i ++){
                target.push(arr[i][y]);
            }
        }
        if(x >= 14){
            for(let i = 17; i >= x - 4; i --){
                target.push(arr[i][y]);
            }
        }

        count.call(this, target);
        
    }

    // 左下方<-->右上方判断
    function leftDown(x, y, target){
        const min = x >= y ? y : x;
        const max = x >= y ? x : x;
        if(min > 3 && min < 14){
            target.push(arr[x][y]);
            for(let i = 1; i <= 4; i ++){
                if(x+i<=17&&y-i>=0){
                    target.push(arr[x+i][y-i])
                }
                if(x-i>=0&&y+i<=17){
                    target.push(arr[x-i][y+i])
                }
            }
        }
        if(min <= 3){
            target.push(arr[x][y]);
            for(let i = 1; i <= 4; i ++){
                if(x-i>=0&&y+i<=17){
                    target.push(arr[x-i][y+i]);
                }
            }
            for(let i = 1; i <= 17 - max; i ++){
                if(x+i<=17&&y-i>=0){
                    target.push(arr[x+i][y-i]);
                }
            }
        }
        if(min >= 14){
            target.push(arr[x][y]);
            for(let i = 1; i <= 4; i ++){
                if(x+i<=17&&y-i>=0){
                    target.push(arr[x+i][y-i]);
                }
            }
            for(let i = 1; i <= 17 - max; i ++){
                if(y+i<=17&&x-i>=0){
                    target.push(arr[x-i][y+i])
                }
            }
        }
        count.call(this, target);
    }

    // 左上方<-->右下方判断
    function leftTop(x, y, target){
        const min = x >= y ? y : x;
        const max = x >= y ? x : y;
        if(min > 3 && min < 14){
            target.push(arr[x][y]);
            for(let i = 1; i <= 4; i ++){
                if(x-i>=0&&y-i>=0){
                    target.push(arr[x-i][y-i]);
                }
                if(x+i<=17&&y+i<=17){
                    target.push(arr[x+i][y+i]);
                }
            }
        }
        if(min <= 3){
            target.push(arr[x][y]);
            for(i = 1; i <= 4; i ++){
                if(x+i<=17&&y+i<=17){
                    target.push(arr[x+i][y+i]);
                }
            }
            for(i = 1; i <= min; i ++){
                if(x-i>=0&&y-i>=0){
                    target.push(arr[x-i][y-i])
                }
            }
        }
        if(min >= 14){
            target.push(arr[x][y]);;
            for(let i = 1; i <= 4; i ++){
                if(x-i>=0&&y-i>=0){
                    target.push(arr[x-i][y-i]);
                }
            }
            for(let i = 1; i <= 17 - max; i ++){
                if(x+i<=17&&y+i<=17){
                    target.push(arr[x+i][y+i]);
                }
            }
        }
        count.call(this, target);
    }

    // 判断相同颜色棋子颜色个数
    function count(target){
        // 筛选出与当前棋子颜色相同的所有棋子并排序(排序是为了后续判断是否连续)
        const rest = target.filter(v => v.$color == this.$color).sort((a, b) => (a.$x-b.$x));
        const len = rest.length;
        if(len < 5){
            return false;
        }
        if(len >= 5){
            const start = rest[0];
            const end = rest[len-1];
            // 横向判断
            if(start.$x == end.$x){
                if(Math.abs(start.$y - end.$y) == len - 1){
                    rest.forEach(v => v.style.background = 'green');
                    result = true;
                } 
            }
            // 纵向判断
            if(start.$y == end.$y){
                if(Math.abs(start.$x - end.$x) == len - 1){
                    rest.forEach(v => v.style.background = 'green');
                    result = true;
                }
            }
            // 斜向判断
            if(Math.abs(start.$x-end.$x) == len - 1){
                if(Math.abs(start.$y - end.$y) == len - 1){
                    rest.forEach(v => v.style.background = 'green');
                    result = true;
                }
            }
        }
    }
</script>
</html>